<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pikmin 座標圖鑑</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        const { useState, useEffect, useRef, Fragment } = React;

        // --- Firebase 設定 (從 CDN 引入) ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, deleteDoc, onSnapshot, query } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-storage.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDWu48irJa30tNSVcczZk4LDB7gyeHEChs",
            authDomain: "pikmin-map-f04c8.firebaseapp.com",
            projectId: "pikmin-map-f04c8",
            storageBucket: "pikmin-map-f04c8.firebasestorage.app",
            messagingSenderId: "978390322128",
            appId: "1:978390322128:web:cacb4c337ea921e37fc7d5"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);
        const appId = 'pikmin-public-v1';

        // --- 內建圖示 (SVG) ---
        const Icon = ({ path }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                {path}
            </svg>
        );

        const ICONS = {
            Leaf: <path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12" />,
            Download: <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4 M7 10l5 5 5-5 M12 15V3" />,
            Plus: <path d="M5 12h14 M12 5v14" />,
            Search: <Fragment><circle cx="11" cy="11" r="8" /><path d="m21 21-4.3-4.3" /></Fragment>,
            Edit2: <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z" />,
            Trash2: <path d="M3 6h18 M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6 M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2 M10 11v6 M14 11v6" />,
            MapPin: <Fragment><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z" /><circle cx="12" cy="10" r="3" /></Fragment>,
            Copy: <Fragment><rect width="14" height="14" x="8" y="8" rx="2" ry="2" /><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2" /></Fragment>,
            Check: <polyline points="20 6 9 17 4 12" />,
            ExternalLink: <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6 M15 3h6v6 M10 14 21 3" />,
            AlertTriangle: <Fragment><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" /><line x1="12" x2="12" y1="9" y2="13" /><line x1="12" x2="12.01" y1="17" y2="17" /></Fragment>,
            X: <path d="M18 6 6 18 M6 6l12 12" />,
            Upload: <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4 M17 8l-5-5-5 5 M12 3v12" />,
            Save: <Fragment><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" /><polyline points="17 21 17 13 7 13 7 21" /><polyline points="7 3 7 8 15 8" /></Fragment>
        };

        const INITIAL_SEEDS = [
            { id: "1770654209716", category: "動漫", series: "辛普森", name: "母女", type: "種花", location: "淡水天元宮附近", lat: "25.189888", lng: "121.488269", lastUpdated: "2026-02-09T16:23:29.716Z" },
            { id: "1769696964978", category: "動漫", series: "烏龍派出所", name: "兩津眉毛", type: "種花", location: "日本東京龜有", lat: "35.764452", lng: "139.847733", lastUpdated: "2026-01-29T14:29:24.978Z" }
        ];

        const App = () => {
            const [user, setUser] = useState(null);
            const [postcards, setPostcards] = useState([]);
            const [loading, setLoading] = useState(true);
            const hasInitializedSeeds = useRef(false);
            const [mainTab, setMainTab] = useState('明信片');
            const [activeCategory, setActiveCategory] = useState("全部");
            const [searchTerm, setSearchTerm] = useState("");
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [editingItem, setEditingItem] = useState(null);
            const [deleteId, setDeleteId] = useState(null);
            const [copyFeedback, setCopyFeedback] = useState(null);
            const [isImporting, setIsImporting] = useState(false);
            const [isUploading, setIsUploading] = useState(false);
            const fileInputRef = useRef(null);
            const [formData, setFormData] = useState({ mainType: "明信片", category: "", series: "", name: "", lat: "", lng: "", location: "", type: "蘑菇", imageUrl: "" });

            useEffect(() => {
                signInAnonymously(auth).catch((error) => console.error("Auth error:", error));
                return onAuthStateChanged(auth, (u) => setUser(u));
            }, []);

            useEffect(() => {
                if (!user) return;
                const q = query(collection(db, 'artifacts', appId, 'public', 'data', 'pikmin_postcards'));
                const unsubscribe = onSnapshot(q, async (snapshot) => {
                    const docs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    if (snapshot.empty && !hasInitializedSeeds.current) {
                        hasInitializedSeeds.current = true;
                        importSeedData();
                    } else {
                        docs.sort((a, b) => new Date(b.lastUpdated || 0) - new Date(a.lastUpdated || 0));
                        setPostcards(docs);
                        setLoading(false);
                    }
                }, (error) => { console.error("Data sync error:", error); setLoading(false); });
                return () => unsubscribe();
            }, [user]);

            const importSeedData = async () => {
                if (!user) return;
                setIsImporting(true);
                try {
                    const promises = INITIAL_SEEDS.map(seed => setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'pikmin_postcards', seed.id), seed, { merge: true }));
                    await Promise.all(promises);
                } catch (err) { console.error("Error seeding data:", err); } finally { setIsImporting(false); }
            };

            const [selectedFile, setSelectedFile] = useState(null);
            const handleImageChange = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                setSelectedFile(file);
                const reader = new FileReader();
                reader.onload = (event) => { setFormData(prev => ({ ...prev, imageUrl: event.target.result })); };
                reader.readAsDataURL(file);
            };
            const handleRemoveImage = () => { setFormData(prev => ({ ...prev, imageUrl: "" })); setSelectedFile(null); };

            const handleOpenModal = (item = null) => {
                if (item) {
                    setEditingItem(item);
                    setFormData({ imageUrl: "", mainType: "明信片", ...item });
                    setSelectedFile(null);
                } else {
                    setEditingItem(null);
                    setFormData({ mainType: mainTab, category: activeCategory === "全部" ? "" : activeCategory, series: "", name: "", lat: "", lng: "", location: "", type: mainTab === '明信片' ? "蘑菇" : "", imageUrl: "" });
                    setSelectedFile(null);
                }
                setIsModalOpen(true);
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!user) return;
                setIsUploading(true);
                const timestamp = new Date().toISOString();
                let finalImageUrl = formData.imageUrl;
                try {
                    if (selectedFile) {
                        const fileExt = selectedFile.name.split('.').pop();
                        const fileName = `${Date.now()}.${fileExt}`;
                        const storageRef = ref(storage, `images/${fileName}`);
                        await uploadBytes(storageRef, selectedFile);
                        finalImageUrl = await getDownloadURL(storageRef);
                    }
                    const newItem = { ...formData, imageUrl: finalImageUrl, lastUpdated: timestamp };
                    if (editingItem) {
                        await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'pikmin_postcards', editingItem.id), newItem, { merge: true });
                    } else {
                        const newId = Date.now().toString();
                        await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'pikmin_postcards', newId), { ...newItem, id: newId });
                    }
                    setIsModalOpen(false);
                } catch (error) { console.error("Save error:", error); alert("儲存失敗: " + error.message); } finally { setIsUploading(false); }
            };

            const confirmDelete = async () => {
                if (deleteId && user) {
                    try { await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'pikmin_postcards', deleteId)); setDeleteId(null); } catch (error) { console.error("Delete error:", error); }
                }
            };

            const handleCopyText = (text, feedbackKey) => {
                navigator.clipboard.writeText(text).then(() => { setCopyFeedback(feedbackKey); setTimeout(() => setCopyFeedback(null), 2000); });
            };

            const handleExportCSV = () => {
                const headers = ["ID", "大區分類", "大類別", "子類別", "名稱", "類型", "地點", "緯度", "經度", "最後更新時間", "圖片連結"];
                const csvContent = [headers.join(","), ...postcards.map(item => [item.id, `"${item.mainType || '明信片'}"`, `"${item.category || ''}"`, `"${item.series || ''}"`, `"${item.name || ''}"`, `"${item.type || ''}"`, `"${item.location || ''}"`, item.lat, item.lng, item.lastUpdated, `"${item.imageUrl || ''}"`].join(","))].join("\n");
                const blob = new Blob(["\uFEFF" + csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement("a");
                link.href = URL.createObjectURL(blob);
                link.setAttribute("download", `pikmin_postcards_${new Date().toISOString().slice(0, 10)}.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            const availableCategories = [...new Set(postcards.filter(p => (p.mainType || '明信片') === '明信片').map(p => p.category))].sort();
            const categories = ["全部", ...availableCategories];
            const availableSubCategories = [...new Set(postcards.filter(p => (p.mainType || '明信片') === '明信片' && (!formData.category || p.category === formData.category)).map(p => p.series).filter(Boolean))].sort();
            const availablePureTypes = [...new Set(postcards.filter(p => p.mainType === '純點').map(p => p.type).filter(Boolean))].sort();

            const displayedItems = postcards.filter(item => {
                const itemMainType = item.mainType || '明信片';
                if (itemMainType !== mainTab) return false;
                if (mainTab === '明信片') {
                    return (activeCategory === "全部" || item.category === activeCategory) && ((item.name || "").toLowerCase().includes(searchTerm.toLowerCase()) || (item.series || "").toLowerCase().includes(searchTerm.toLowerCase()));
                } else {
                    return (item.type || "").toLowerCase().includes(searchTerm.toLowerCase());
                }
            });

            const groupedPostcards = displayedItems.reduce((groups, item) => {
                const key = mainTab === '明信片' ? (item.series || "未分類") : (item.type || "未分類");
                if (!groups[key]) groups[key] = [];
                groups[key].push(item);
                return groups;
            }, {});

            return (
                <div className="min-h-screen bg-slate-50 text-slate-800 font-sans pb-20">
                    <header className="bg-emerald-600 text-white shadow-lg sticky top-0 z-20">
                        <div className="max-w-5xl mx-auto px-4 py-4 flex items-center justify-between">
                            <div className="flex items-center gap-2"><Icon path={ICONS.Leaf} /><h1 className="text-xl font-bold">Pikmin 座標圖鑑</h1></div>
                            <div className="flex gap-2">
                                <button onClick={handleExportCSV} className="bg-emerald-700/50 hover:bg-emerald-700 text-white px-3 py-2 rounded-lg text-sm flex items-center gap-2"><Icon path={ICONS.Download} />匯出</button>
                                <button onClick={() => handleOpenModal()} className="bg-white text-emerald-700 hover:bg-lime-50 px-3 py-2 rounded-lg font-bold flex items-center gap-2 text-sm"><Icon path={ICONS.Plus} />新增</button>
                            </div>
                        </div>
                    </header>
                    <main className="max-w-5xl mx-auto px-4 py-6">
                        {loading && <div className="text-center py-10">載入中...</div>}
                        {!loading && (
                            <>
                                <div className="flex border-b border-slate-200 mb-6">
                                    <button onClick={() => setMainTab('明信片')} className={`pb-3 px-6 text-sm font-bold border-b-2 transition-colors ${mainTab === '明信片' ? 'border-emerald-500 text-emerald-600' : 'border-transparent text-slate-500'}`}>明信片</button>
                                    <button onClick={() => setMainTab('純點')} className={`pb-3 px-6 text-sm font-bold border-b-2 transition-colors ${mainTab === '純點' ? 'border-emerald-500 text-emerald-600' : 'border-transparent text-slate-500'}`}>純點</button>
                                </div>
                                <div className="flex flex-col md:flex-row gap-4 mb-8 justify-between">
                                    {mainTab === '明信片' && (
                                        <div className="flex flex-wrap gap-2">{categories.map(cat => (<button key={cat} onClick={() => setActiveCategory(cat)} className={`px-4 py-1.5 rounded-full text-sm font-medium ${activeCategory === cat ? 'bg-emerald-600 text-white' : 'bg-white border border-slate-200 text-slate-600'}`}>{cat}</button>))}</div>
                                    )}
                                    <div className="relative w-full md:w-64"><div className="absolute left-3 top-2.5 text-slate-400"><Icon path={ICONS.Search} /></div><input type="text" placeholder="搜尋..." value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} className="w-full pl-9 pr-4 py-2 rounded-lg border border-slate-200 text-sm" /></div>
                                </div>
                                <div className="space-y-8">
                                    {Object.entries(groupedPostcards).map(([groupKey, items]) => (
                                        <section key={groupKey}>
                                            <h2 className="text-xl font-bold text-slate-700 mb-4 pl-3 border-l-4 border-emerald-500">{groupKey}</h2>
                                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                                {items.map(item => (
                                                    <div key={item.id} className="bg-white rounded-xl shadow-sm border border-slate-100 p-5 relative group">
                                                        <div className="absolute top-4 right-4 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity z-10">
                                                            <button onClick={(e) => { e.stopPropagation(); handleOpenModal(item); }} className="p-1.5 bg-white border rounded text-slate-400 hover:text-blue-500"><Icon path={ICONS.Edit2} /></button>
                                                            <button onClick={(e) => { e.stopPropagation(); setDeleteId(item.id); }} className="p-1.5 bg-white border rounded text-slate-400 hover:text-red-500"><Icon path={ICONS.Trash2} /></button>
                                                        </div>
                                                        {mainTab === '明信片' && (
                                                            <>
                                                                {item.imageUrl && (<div className="mb-4 -mx-5 -mt-5 h-40 bg-slate-100 overflow-hidden relative rounded-t-xl"><img src={item.imageUrl} alt={item.name} className="w-full h-full object-cover" /></div>)}
                                                                <div className={`mb-3 ${!item.imageUrl ? '' : 'pt-1'}`}>
                                                                    <div className="flex items-center gap-2 mb-1"><span className={`text-[10px] px-2 py-0.5 rounded font-bold uppercase ${item.type === '蘑菇' ? 'bg-purple-100 text-purple-700' : item.type === '種花' ? 'bg-pink-100 text-pink-700' : 'bg-amber-100 text-amber-800'}`}>{item.type}</span><span className="text-xs text-slate-400">{item.category}</span></div>
                                                                    <h3 className="text-lg font-bold text-slate-800">{item.name}</h3>
                                                                </div>
                                                            </>
                                                        )}
                                                        {mainTab === '純點' && (<div className="mb-3"><span className="text-[10px] px-2 py-0.5 rounded font-bold uppercase bg-blue-100 text-blue-700 mr-2">純點</span><span className="text-xs font-bold text-slate-500 bg-slate-100 px-2 py-0.5 rounded">{item.type}</span></div>)}
                                                        <div className="space-y-3 text-sm text-slate-600">
                                                            {mainTab === '明信片' ? (<div className="flex items-start gap-2"><div className="mt-0.5 text-emerald-500 shrink-0"><Icon path={ICONS.MapPin} /></div><span>{item.location}</span></div>) : (<h3 className="text-base font-bold text-slate-800 flex items-start gap-2 mb-2"><div className="mt-0.5 text-emerald-500 shrink-0"><Icon path={ICONS.MapPin} /></div>{item.location || '未提供地點說明'}</h3>)}
                                                            <div className="bg-slate-50 rounded-lg p-3 space-y-2 border border-slate-100">
                                                                <div className="flex justify-between"><div className="flex gap-2"><span className="text-[10px] font-bold text-slate-400 w-8">Lat</span><code className="text-xs font-mono">{item.lat}</code></div><button onClick={() => handleCopyText(item.lat, `${item.id}-lat`)} className="text-slate-400 hover:text-emerald-500"><Icon path={copyFeedback === `${item.id}-lat` ? ICONS.Check : ICONS.Copy} /></button></div>
                                                                <div className="flex justify-between border-t border-slate-200/50 pt-2"><div className="flex gap-2"><span className="text-[10px] font-bold text-slate-400 w-8">Lng</span><code className="text-xs font-mono">{item.lng}</code></div><button onClick={() => handleCopyText(item.lng, `${item.id}-lng`)} className="text-slate-400 hover:text-emerald-500"><Icon path={copyFeedback === `${item.id}-lng` ? ICONS.Check : ICONS.Copy} /></button></div>
                                                            </div>
                                                            <a href={`https://www.google.com/maps?q=${item.lat},${item.lng}`} target="_blank" rel="noreferrer" className="w-full flex items-center justify-center gap-2 py-1.5 bg-blue-50 text-blue-600 rounded-lg text-xs font-medium"><Icon path={ICONS.ExternalLink} />在 Google 地圖中查看</a>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </section>
                                    ))}
                                </div>
                            </>
                        )}
                    </main>
                    {deleteId && (
                        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm z-[60] flex items-center justify-center p-4">
                            <div className="bg-white rounded-2xl shadow-xl w-full max-w-sm p-6 text-center">
                                <div className="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4 text-red-600"><Icon path={ICONS.AlertTriangle} /></div>
                                <h3 className="text-lg font-bold mb-2">確定要刪除嗎？</h3>
                                <div className="flex gap-3 mt-6"><button onClick={() => setDeleteId(null)} className="flex-1 py-2 rounded-lg border">取消</button><button onClick={confirmDelete} className="flex-1 py-2 rounded-lg bg-red-600 text-white">確認</button></div>
                            </div>
                        </div>
                    )}
                    {isModalOpen && (
                        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                            <div className="bg-white rounded-2xl shadow-xl w-full max-w-md flex flex-col max-h-[90vh]">
                                <div className="px-6 py-4 border-b flex justify-between items-center"><h3 className="text-lg font-bold">{editingItem ? '編輯' : '新增'}</h3><button onClick={() => setIsModalOpen(false)}><Icon path={ICONS.X} /></button></div>
                                <form onSubmit={handleSubmit} className="p-6 space-y-4 overflow-y-auto">
                                    {!editingItem && (
                                        <div className="flex bg-slate-100 p-1 rounded-lg mb-2">
                                            <button type="button" onClick={() => setFormData({ ...formData, mainType: '明信片', type: '蘑菇' })} className={`flex-1 py-1.5 text-sm font-bold rounded ${formData.mainType === '明信片' ? 'bg-white shadow text-emerald-600' : 'text-slate-500'}`}>明信片</button>
                                            <button type="button" onClick={() => setFormData({ ...formData, mainType: '純點', type: '' })} className={`flex-1 py-1.5 text-sm font-bold rounded ${formData.mainType === '純點' ? 'bg-white shadow text-emerald-600' : 'text-slate-500'}`}>純點</button>
                                        </div>
                                    )}
                                    {formData.mainType === '明信片' ? (
                                        <>
                                            <div className="space-y-2">
                                                <label className="block text-xs font-bold text-slate-500">明信片照片</label>
                                                <input type="file" ref={fileInputRef} onChange={handleImageChange} accept="image/*" className="hidden" />
                                                {formData.imageUrl ? (
                                                    <div className="relative rounded-lg overflow-hidden border group h-48">
                                                        <img src={formData.imageUrl} alt="Preview" className="w-full h-full object-cover" />
                                                        <div className="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 flex items-center justify-center gap-2 transition-opacity">
                                                            <button type="button" onClick={() => fileInputRef.current?.click()} className="bg-white px-3 py-1 rounded text-xs font-bold">更換</button>
                                                            <button type="button" onClick={handleRemoveImage} className="bg-red-500 text-white px-3 py-1 rounded text-xs font-bold">移除</button>
                                                        </div>
                                                    </div>
                                                ) : (<button type="button" onClick={() => fileInputRef.current?.click()} className="w-full h-32 border-2 border-dashed rounded-lg flex flex-col items-center justify-center text-slate-400 hover:text-emerald-600 hover:bg-emerald-50"><div className="flex flex-col items-center"><Icon path={ICONS.Upload} /><span className="text-xs mt-2">上傳照片</span></div></button>)}
                                            </div>
                                            <div className="grid grid-cols-2 gap-4">
                                                <div><label className="text-xs font-bold text-slate-500">大類別</label><input list="cat-opts" className="w-full border rounded p-2 text-sm" value={formData.category} onChange={e => setFormData({ ...formData, category: e.target.value })} /><datalist id="cat-opts">{categories.filter(c => c !== "全部").map(c => <option key={c} value={c} />)}</datalist></div>
                                                <div><label className="text-xs font-bold text-slate-500">類型</label><select className="w-full border rounded p-2 text-sm" value={formData.type} onChange={e => setFormData({ ...formData, type: e.target.value })}><option value="蘑菇">蘑菇</option><option value="種花">種花</option><option value="都有">都有</option></select></div>
                                            </div>
                                            <div><label className="text-xs font-bold text-slate-500">子類別</label><input list="sub-opts" className="w-full border rounded p-2 text-sm" value={formData.series} onChange={e => setFormData({ ...formData, series: e.target.value })} /><datalist id="sub-opts">{availableSubCategories.map(s => <option key={s} value={s} />)}</datalist></div>
                                            <div><label className="text-xs font-bold text-slate-500">名稱</label><input className="w-full border rounded p-2 text-sm" value={formData.name} onChange={e => setFormData({ ...formData, name: e.target.value })} /></div>
                                        </>
                                    ) : (<div><label className="text-xs font-bold text-slate-500">純點類型</label><input list="pure-opts" className="w-full border rounded p-2 text-sm" value={formData.type} onChange={e => setFormData({ ...formData, type: e.target.value })} /><datalist id="pure-opts">{availablePureTypes.map(t => <option key={t} value={t} />)}</datalist></div>)}
                                    <div><label className="text-xs font-bold text-slate-500">地點說明</label><input className="w-full border rounded p-2 text-sm" value={formData.location} onChange={e => setFormData({ ...formData, location: e.target.value })} /></div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div><label className="text-xs font-bold text-slate-500">緯度 (Lat)</label><input className="w-full border rounded p-2 text-sm font-mono" value={formData.lat} onChange={e => setFormData({ ...formData, lat: e.target.value })} /></div>
                                        <div><label className="text-xs font-bold text-slate-500">經度 (Lng)</label><input className="w-full border rounded p-2 text-sm font-mono" value={formData.lng} onChange={e => setFormData({ ...formData, lng: e.target.value })} /></div>
                                    </div>
                                    <div className="pt-4 flex gap-3">
                                        <button type="button" onClick={() => setIsModalOpen(false)} className="flex-1 py-2 border rounded">取消</button>
                                        <button type="submit" disabled={isUploading} className="flex-1 py-2 bg-emerald-600 text-white rounded flex items-center justify-center gap-2">{isUploading ? '上傳中...' : <><Icon path={ICONS.Save} />儲存</>}</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>